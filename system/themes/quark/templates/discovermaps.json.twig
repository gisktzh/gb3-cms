{% set title = 'discover-maps' %}
{% set collection_name = 'discovermaps' %}

{% set collection = grav.get('flex').collection(collection_name) %}
{% set current_month = 'today'|date('Ymd') %}
{% set active_items = collection.getKeys()
    |map(active_item_entry_key => collection.get(active_item_entry_key).header|merge({flex_id: active_item_entry_key}))
    |filter(active_item => (active_item.from_date|date('Ymd') <= current_month and active_item.to_date|date('Ymd') >= current_month)) %}

{"{{- title -}}":[
{% for active_item in active_items %}
{% if active_item.image %}{% set active_item = active_item|merge({'image': (active_item.image|first)}) %}{% endif %}
{{- active_item|json_encode|raw -}}
{% if not loop.last %},{% endif %}
{% endfor %}
]}

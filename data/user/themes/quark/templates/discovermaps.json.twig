{% set flex = grav.get('flex_objects') %}
{% set discovermaps = flex.directory('discovermaps') %}
{% set collection = discovermaps.getCollection() %}

{% set current_month = 'today'|date('Ymd') %}
{% set active_items = collection
    |map(active_item_entry => active_item_entry.header)
    |filter(active_item => (active_item.from_date|date('Ymd') <= current_month and active_item.to_date|date('Ymd') >= current_month)) %}

{"discover-maps":[
{% for active_item in active_items %}
{% if active_item.image %}{% set active_item = active_item|merge({'image': (active_item.image|first)}) %}{% endif %}
{{- active_item|json_encode|raw -}}
{% if not loop.last %},{% endif %}
{% endfor %}
]}
